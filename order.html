<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ—…éŠé é»é¤ç³»çµ±</title>
    <style>
        body { font-family: "Microsoft JhengHei", sans-serif; background: #f5f7fa; padding: 20px; max-width: 800px; margin: 0 auto; color: #333; }
        h2 { text-align: center; color: #2c3e50; margin-bottom: 5px; }
        .sub-title { text-align: center; color: #7f8c8d; font-size: 0.9rem; margin-bottom: 20px; }
        
        /* å¡ç‰‡æ¨£å¼ */
        .card { background: white; padding: 20px; border-radius: 15px; box-shadow: 0 4px 10px rgba(0,0,0,0.1); margin-bottom: 20px; border: 1px solid #eee; }
        .section-title { font-size: 1.4rem; font-weight: bold; color: #d35400; border-left: 5px solid #d35400; padding-left: 10px; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        
        /* å€’æ•¸è¨ˆæ™‚æ¢ */
        .countdown-bar { background: #fdebd0; color: #d35400; padding: 8px 12px; border-radius: 5px; font-size: 0.9rem; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; font-weight: bold; }
        .countdown-bar.expired { background: #bdc3c7; color: #7f8c8d; }

        /* å®¶æ—ç¯©é¸å™¨ */
        .family-selector { width: 100%; padding: 12px; font-size: 1.1rem; border: 2px solid #3498db; border-radius: 10px; background: white; margin-bottom: 15px; color: #2c3e50; font-weight: bold; }

        /* èœå–®åˆ—è¡¨ (Grid æ’ç‰ˆï¼Œæ”¯æ´åœ–ç‰‡) */
        .menu-grid { display: grid; grid-template-columns: 1fr; gap: 15px; }
        @media (min-width: 600px) { .menu-grid { grid-template-columns: 1fr 1fr; } }

        .menu-item { display: flex; align-items: center; background: #fafafa; padding: 10px; border-radius: 10px; border: 1px solid #eee; }
        .item-img { width: 60px; height: 60px; object-fit: cover; border-radius: 8px; margin-right: 15px; background: #ddd; }
        .item-info { flex-grow: 1; }
        .item-name { font-weight: bold; font-size: 1rem; color: #2c3e50; display: block; margin-bottom: 5px; }
        
        /* è¼¸å…¥æ¡†èˆ‡æŒ‰éˆ• */
        input[type="number"] { padding: 8px; border: 1px solid #ccc; border-radius: 8px; font-size: 1.1rem; width: 50px; text-align: center; }
        input[type="number"]:disabled { background: #eee; color: #aaa; border-color: #ddd; }

        .btn-action { 
            width: 100%; padding: 15px; border: none; border-radius: 50px; font-size: 1.3rem; font-weight: bold; cursor: pointer; margin-top: 10px; transition: all 0.3s; 
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }
        /* ç¢ºèªç‹€æ…‹ (ç¶ è‰²) */
        .btn-confirm { background: #27ae60; color: white; }
        .btn-confirm:hover { background: #219150; }
        
        /* ä¿®æ”¹ç‹€æ…‹ (æ©˜è‰²) */
        .btn-modify { background: #f39c12; color: white; }
        .btn-modify:hover { background: #e67e22; }

        /* ç¦ç”¨ç‹€æ…‹ */
        .btn-disabled { background: #95a5a6 !important; cursor: not-allowed; box-shadow: none; }
        
        .btn-back { display: block; text-align: center; margin-top: 30px; color: #7f8c8d; text-decoration: none; padding: 10px; border-radius: 20px; border: 1px solid #ddd; background: white;}

        /* ç®¡ç†å“¡å…¥å£ */
        .admin-trigger { position: fixed; top: 10px; right: 10px; opacity: 0.2; font-size: 1.5rem; cursor: pointer; z-index: 999; }
        
        /* ç®¡ç†å¾Œå°æ¨£å¼ */
        #admin-panel { display: none; border: 2px solid #e74c3c; background: #fff5f5; margin-top: 30px; }
        .admin-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; border-bottom: 2px solid #e74c3c; padding-bottom: 10px;}
        
        .admin-flex-container { display: flex; flex-wrap: wrap; gap: 20px; }
        .admin-box { flex: 1 1 300px; background: white; padding: 15px; border-radius: 10px; border: 1px solid #ddd; }
        .admin-box h4 { margin-top: 0; color: #d35400; border-bottom: 1px solid #eee; padding-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        
        .lock-btn { padding: 5px 10px; font-size: 0.8rem; border-radius: 5px; border: none; cursor: pointer; color: white; }
        .is-open { background: #27ae60; }
        .is-locked { background: #c0392b; }

        .stat-row { display: flex; justify-content: space-between; padding: 5px 0; border-bottom: 1px dashed #eee; font-size: 0.95rem; }
        .stat-count { font-weight: bold; color: #2980b9; }
    </style>
</head>
<body>

    <h2>ğŸœ é å…ˆé»é¤ç³»çµ±</h2>
    <div class="sub-title">è«‹é¸æ“‡æ‚¨çš„çµ„åˆ¥ä¸¦å®Œæˆé»é¤</div>

    <div id="order-form">
        <div class="card">
            <label style="font-weight: bold; display: block; margin-bottom: 8px;">è«‹å•æ‚¨æ˜¯å“ªä¸€å®¶ï¼Ÿ</label>
            <select id="family-group" class="family-selector">
                <option value="" disabled selected>è«‹é¸æ“‡çµ„åˆ¥...</option>
                <option value="å¤ªå¹³">å¤ªå¹³</option>
                <option value="ç²å®¶">ç²å®¶</option>
                <option value="æå®¶">æå®¶</option>
                <option value="è‘µå®¶">è‘µå®¶</option>
                <option value="Judyå®¶">Judyå®¶</option>
                <option value="Jillå®¶">Jillå®¶</option>
            </select>
            
            <label style="font-weight: bold; display: block; margin-bottom: 8px;">å¡«å¯«äººå§“åï¼š</label>
            <input type="text" id="username" placeholder="è«‹è¼¸å…¥æ‚¨çš„åå­—" style="width: 100%; padding: 10px; border: 1px solid #ccc; border-radius: 8px; box-sizing: border-box;">
        </div>

        <div class="card" id="card-day2">
            <div class="section-title">DAY 2ï¼šå¼å¼Œ-å’ŒèŒ—åœ’</div>
            <div class="countdown-bar" id="timer-day2">
                <span>â³ é–å–®å€’æ•¸ï¼šè¨ˆç®—ä¸­...</span>
                <span id="status-day2">é–‹æ”¾ä¸­</span>
            </div>
            
            <div class="menu-grid" id="menu-day2">
                </div>
        </div>

        <div class="card" id="card-day3">
            <div class="section-title">DAY 3ï¼šæ‰“è²“å»šæˆ¿</div>
            <div class="countdown-bar" id="timer-day3">
                <span>â³ é–å–®å€’æ•¸ï¼šè¨ˆç®—ä¸­...</span>
                <span id="status-day3">é–‹æ”¾ä¸­</span>
            </div>

            <div class="menu-grid" id="menu-day3">
                </div>
        </div>

        <button id="btn-action" class="btn-action btn-confirm">ç¢ºèªé»é¤</button>
        <p style="text-align: center; color: #999; font-size: 0.8rem; margin-top: 10px;">é»é¸ç¢ºèªå¾Œå³å®Œæˆé€å–®ï¼Œå¦‚éœ€ä¿®æ”¹è«‹å†æ¬¡é»é¸æŒ‰éˆ•ã€‚</p>
    </div>

    <a href="index.html" class="btn-back">â¬… å›åˆ°è¡Œç¨‹è¡¨</a>

    <div class="admin-trigger" onclick="openAdmin()">âš™ï¸</div>

    <div id="admin-panel" class="card">
        <div class="admin-header">
            <h3 style="margin:0;">ğŸ“Š å¾Œå°ç®¡ç†</h3>
            <button onclick="document.getElementById('admin-panel').style.display='none'" style="border:none; background:none; font-size:1.2rem; cursor:pointer;">âœ–</button>
        </div>
        
        <div class="admin-flex-container">
            <div class="admin-box">
                <h4>
                    DAY 2 çµ±è¨ˆ
                    <button id="btn-lock-day2" class="lock-btn is-open">é–å®š</button>
                </h4>
                <div id="stats-day2">è¼‰å…¥ä¸­...</div>
            </div>

            <div class="admin-box">
                <h4>
                    DAY 3 çµ±è¨ˆ
                    <button id="btn-lock-day3" class="lock-btn is-open">é–å®š</button>
                </h4>
                <div id="stats-day3">è¼‰å…¥ä¸­...</div>
            </div>
        </div>
        <div style="margin-top: 15px; font-size: 0.9rem; color: #666;">ç¸½å¡«å–®äººæ•¸ï¼š<span id="total-orders-count">0</span> äºº</div>
    </div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { getDatabase, ref, push, set, onValue, get, update } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

        // Firebase Config
       const firebaseConfig = {
  apiKey: "AIzaSyC_S8VS1Tgtjdh2eyavGR3jN2BmWF_Etg4",
  authDomain: "tainan-trip-order.firebaseapp.com",
  // â˜…â˜…â˜… è«‹å‹™å¿…ç¢ºèªæœ‰åŠ ä¸Šé€™ä¸€è¡Œï¼Œé€™æ˜¯æ‚¨æˆªåœ–ä¸­çš„è³‡æ–™åº«ç¶²å€ â˜…â˜…â˜…
  databaseURL: "https://tainan-trip-order-default-rtdb.asia-southeast1.firebasedatabase.app",
  projectId: "tainan-trip-order",
  storageBucket: "tainan-trip-order.firebasestorage.app",
  messagingSenderId: "171271367128",
  appId: "1:171271367128:web:91d2cb419a35902dec2aad",
  measurementId: "G-Y8P3XCTS1Q"
};

        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app);

        // --- 1. èœå–®è³‡æ–™ (Day 2 & Day 3 åˆ†é–‹) ---
        // â˜… åœ–ç‰‡èªªæ˜ï¼šæ‚¨å¯ä»¥å°‡ 'image' æ¬„ä½æ›æˆçœŸå¯¦åœ–ç‰‡ç¶²å€ï¼Œç›®å‰ä½¿ç”¨å‡åœ–ä½”ä½
        const menuDay2 = [
            { id: "d2_1", name: "æ‹›ç‰Œç‰›è‚‰éºµ", image: "https://via.placeholder.com/100?text=Beef" },
            { id: "d2_2", name: "é®®è¦é¤›é£©éºµ", image: "https://via.placeholder.com/100?text=Wonton" },
            { id: "d2_3", name: "å¤æ—©å‘³æ»·è‚‰é£¯", image: "https://via.placeholder.com/100?text=Rice" },
            { id: "d2_4", name: "ç‡™é’èœ", image: "https://via.placeholder.com/100?text=Veg" }
        ];

        const menuDay3 = [
            { id: "d3_1", name: "ç¶“å…¸ç¾å¼æ¼¢å ¡", image: "https://via.placeholder.com/100?text=Burger" },
            { id: "d3_2", name: "æ¾éœ²é‡è‡ç‡‰é£¯", image: "https://via.placeholder.com/100?text=Risotto" },
            { id: "d3_3", name: "ç…™ç‡»é®­é­šæ²™æ‹‰", image: "https://via.placeholder.com/100?text=Salad" },
            { id: "d3_4", name: "ç‚¸ç‰©æ‹¼ç›¤", image: "https://via.placeholder.com/100?text=Fried" }
        ];

        // --- 2. æˆªæ­¢æ™‚é–“è¨­å®š (è¨­å®šç‚º 2026 å¹´) ---
        const DEADLINE_DAY2 = new Date("2026-02-20T10:30:00").getTime();
        const DEADLINE_DAY3 = new Date("2026-02-21T10:30:00").getTime();

        // ç‹€æ…‹è®Šæ•¸
        let isSubmitted = false; // æ˜¯å¦å·²ç¢ºèªé»é¤
        let adminLockedDay2 = false; // ç®¡ç†å“¡æ‰‹å‹•é–å®š Day 2
        let adminLockedDay3 = false; // ç®¡ç†å“¡æ‰‹å‹•é–å®š Day 3

        // --- 3. åˆå§‹åŒ–ç•«é¢ ---
        function renderMenu(containerId, data, dayPrefix) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            data.forEach(item => {
                const div = document.createElement('div');
                div.className = 'menu-item';
                div.innerHTML = `
                    <img src="${item.image}" class="item-img" alt="é¤é»åœ–ç‰‡">
                    <div class="item-info">
                        <span class="item-name">${item.name}</span>
                    </div>
                    <input type="number" min="0" class="qty-input ${dayPrefix}" 
                           data-id="${item.id}" data-name="${item.name}" 
                           data-day="${dayPrefix}" placeholder="0">
                `;
                container.appendChild(div);
            });
            
            // è¼¸å…¥æ¡†èšç„¦æ™‚æ¸…ç©º 0
            document.querySelectorAll('.qty-input').forEach(input => {
                input.addEventListener('focus', function() { if(this.value=='0') this.value=''; });
                input.addEventListener('blur', function() { if(this.value=='') this.value='0'; });
            });
        }

        renderMenu('menu-day2', menuDay2, 'day2');
        renderMenu('menu-day3', menuDay3, 'day3');

        // --- 4. å€’æ•¸è¨ˆæ™‚èˆ‡è‡ªå‹•é–å–®é‚è¼¯ ---
        function updateTimer() {
            const now = new Date().getTime();
            
            // Day 2
            const diff2 = DEADLINE_DAY2 - now;
            const timerEl2 = document.getElementById('timer-day2');
            const statusEl2 = document.getElementById('status-day2');
            
            if (diff2 <= 0 || adminLockedDay2) {
                timerEl2.innerHTML = "ğŸ”’ DAY 2 å·²æˆªæ­¢æ”¶å–®";
                timerEl2.classList.add('expired');
                disableSection('day2');
            } else {
                const h = Math.floor((diff2 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff2 % (1000 * 60 * 60)) / (1000 * 60));
                timerEl2.querySelector('span').innerText = `â³ å‰©é¤˜ ${h}å°æ™‚ ${m}åˆ†`;
                if(!isSubmitted) enableSection('day2'); // åªæœ‰åœ¨æœªé€å‡ºä¸”æœªéæœŸæ™‚æ‰é–‹å•Ÿ
            }

            // Day 3
            const diff3 = DEADLINE_DAY3 - now;
            const timerEl3 = document.getElementById('timer-day3');
            
            if (diff3 <= 0 || adminLockedDay3) {
                timerEl3.innerHTML = "ğŸ”’ DAY 3 å·²æˆªæ­¢æ”¶å–®";
                timerEl3.classList.add('expired');
                disableSection('day3');
            } else {
                const h = Math.floor((diff3 % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const m = Math.floor((diff3 % (1000 * 60 * 60)) / (1000 * 60));
                timerEl3.querySelector('span').innerText = `â³ å‰©é¤˜ ${h}å°æ™‚ ${m}åˆ†`;
                if(!isSubmitted) enableSection('day3');
            }
        }

        function disableSection(dayClass) {
            document.querySelectorAll(`.qty-input.${dayClass}`).forEach(input => {
                input.disabled = true;
            });
        }

        function enableSection(dayClass) {
            // åªæœ‰åœ¨ã€Œä¿®æ”¹æ¨¡å¼ã€æˆ–ã€Œå°šæœªé€å‡ºã€æ™‚æ‰è§£é–
            if (!isSubmitted) {
                document.querySelectorAll(`.qty-input.${dayClass}`).forEach(input => {
                    input.disabled = false;
                });
            }
        }

        setInterval(updateTimer, 1000); // æ¯ç§’æ›´æ–°

        // --- 5. Firebase ç›£è½ç®¡ç†å“¡é–å–® ---
        const configRef = ref(db, 'config');
        onValue(configRef, (snapshot) => {
            const config = snapshot.val() || {};
            adminLockedDay2 = config.lockDay2 || false;
            adminLockedDay3 = config.lockDay3 || false;
            
            updateTimer(); // ç«‹å³è§¸ç™¼ç‹€æ…‹æ›´æ–°
            updateAdminLockButtons(); // æ›´æ–°å¾Œå°æŒ‰éˆ•ç‹€æ…‹
        });

        // --- 6. ç¢ºèª/ä¿®æ”¹æŒ‰éˆ•é‚è¼¯ ---
        const btnAction = document.getElementById('btn-action');
        
        btnAction.addEventListener('click', () => {
            const family = document.getElementById('family-group').value;
            const name = document.getElementById('username').value.trim();

            if (!family) { alert("è«‹é¸æ“‡æ‚¨çš„çµ„åˆ¥ï¼"); return; }
            if (!name) { alert("è«‹è¼¸å…¥å¡«å¯«äººå§“åï¼"); return; }

            if (!isSubmitted) {
                // === ç›®å‰æ˜¯ã€Œç¢ºèªé»é¤ã€ç‹€æ…‹ï¼ŒåŸ·è¡Œé€å‡º ===
                
                // æ”¶é›†æ•¸æ“š
                let orderData = {
                    family: family,
                    name: name,
                    timestamp: new Date().toLocaleString(),
                    day2: {},
                    day3: {}
                };

                let hasItem = false;

                // æ”¶é›† Day 2
                document.querySelectorAll('.qty-input.day2').forEach(input => {
                    const qty = parseInt(input.value) || 0;
                    if (qty > 0) {
                        orderData.day2[input.dataset.id] = { name: input.dataset.name, qty: qty };
                        hasItem = true;
                    }
                });

                // æ”¶é›† Day 3
                document.querySelectorAll('.qty-input.day3').forEach(input => {
                    const qty = parseInt(input.value) || 0;
                    if (qty > 0) {
                        orderData.day3[input.dataset.id] = { name: input.dataset.name, qty: qty };
                        hasItem = true;
                    }
                });

                if (!hasItem) { alert("æ‚¨å¥½åƒæ²’æœ‰é»ä»»ä½•æ±è¥¿å–”ï¼Ÿ"); return; }

                // å„²å­˜åˆ° Firebase
                // é€™è£¡ä½¿ç”¨ pushï¼Œä½†ç‚ºäº†æ”¯æ´ä¿®æ”¹ï¼Œç†æƒ³ä¸Šå¯ä»¥ç”¨ set ä¸¦ä»¥ name+family ç•¶ keyï¼Œ
                // ä½†ç‚ºäº†ç°¡å–®èµ·è¦‹ï¼Œæˆ‘å€‘å…ˆç”¨ push (æ–°å¢ä¸€ç­†)ï¼Œä¸¦åœ¨å‰ç«¯é–å®šè¼¸å…¥æ¡†ã€‚
                // è‹¥è¦åš´è¬¹çš„ã€Œä¿®æ”¹ã€éœ€è¦çŸ¥é“ä¸Šä¸€ç­†çš„ keyï¼Œé€™è£¡ç°¡åŒ–ç‚ºï¼šå†æ¬¡é»æ“Šã€Œç¢ºèªã€æœƒæ–°å¢ä¸€ç­†æ–°çš„ (æˆ–è¦†è“‹)ã€‚
                // ç‚ºäº†è®“é‚è¼¯ç°¡å–®ï¼Œæˆ‘å€‘å‡è¨­é€™è£¡æ˜¯ "æ›´æ–°æœ€æ–°ç‹€æ…‹"
                
                // é€™è£¡æˆ‘å€‘ç”¨ä¸€å€‹ç°¡å–®çš„ key ç”Ÿæˆæ–¹å¼ï¼š Family_Name
                const orderId = `${family}_${name}`;
                set(ref(db, 'orders/' + orderId), orderData)
                    .then(() => {
                        alert("âœ… é»é¤æˆåŠŸï¼\nè³‡æ–™å·²é€å‡ºï¼Œå¦‚éœ€ä¿®æ”¹è«‹é»é¸ã€Œä¿®æ”¹é¤é»ã€ã€‚");
                        
                        // åˆ‡æ›ç‚ºå·²ç¢ºèªç‹€æ…‹
                        isSubmitted = true;
                        
                        // é–å®šæ‰€æœ‰è¼¸å…¥æ¡†
                        document.querySelectorAll('.qty-input').forEach(input => input.disabled = true);
                        document.getElementById('family-group').disabled = true;
                        document.getElementById('username').disabled = true;

                        // æ”¹è®ŠæŒ‰éˆ•æ¨£å¼
                        btnAction.innerText = "âœï¸ ä¿®æ”¹é¤é»";
                        btnAction.className = "btn-action btn-modify";
                    })
                    .catch((err) => alert("é€å‡ºå¤±æ•—ï¼š" + err.message));

            } else {
                // === ç›®å‰æ˜¯ã€Œä¿®æ”¹é¤é»ã€ç‹€æ…‹ï¼ŒåŸ·è¡Œè§£é– ===
                const pwd = prompt("è«‹è¼¸å…¥æ‚¨çš„åå­—ä»¥ç¢ºèªä¿®æ”¹ï¼š"); // ç°¡å–®é˜²è­·ï¼Œé˜²æ­¢èª¤æŒ‰
                if (pwd !== name) {
                    alert("å§“åä¸ç¬¦ï¼Œç„¡æ³•ä¿®æ”¹ï¼");
                    return;
                }

                isSubmitted = false;
                
                // è§£é–è¼¸å…¥æ¡† (éœ€åˆ¤æ–·æ˜¯å¦éæœŸ)
                document.getElementById('family-group').disabled = false;
                document.getElementById('username').disabled = false;
                updateTimer(); // è®“ timer å‡½æ•¸å»åˆ¤æ–·å“ªäº›å¤©å¯ä»¥è§£é–

                // æ”¹è®ŠæŒ‰éˆ•æ¨£å¼
                btnAction.innerText = "ç¢ºèªé»é¤";
                btnAction.className = "btn-action btn-confirm";
            }
        });


        // --- 7. å¾Œå°åŠŸèƒ½ ---
        window.openAdmin = function() {
            const pwd = prompt("è«‹è¼¸å…¥ç®¡ç†å“¡å¯†ç¢¼ï¼š");
            if (pwd === "8888") { 
                document.getElementById('admin-panel').style.display = 'block';
                document.getElementById('admin-panel').scrollIntoView({behavior: "smooth"});
                loadAdminData(); 
            } else {
                if(pwd !== null) alert("å¯†ç¢¼éŒ¯èª¤ï¼");
            }
        };

        // å¾Œå°é–å–®æŒ‰éˆ•
        function updateAdminLockButtons() {
            const btn2 = document.getElementById('btn-lock-day2');
            const btn3 = document.getElementById('btn-lock-day3');
            
            if(adminLockedDay2) {
                btn2.innerText = "å·²é–å®š (é»æ­¤è§£é–)";
                btn2.className = "lock-btn is-locked";
            } else {
                btn2.innerText = "é–‹æ”¾ä¸­ (é»æ­¤é–å®š)";
                btn2.className = "lock-btn is-open";
            }

            if(adminLockedDay3) {
                btn3.innerText = "å·²é–å®š (é»æ­¤è§£é–)";
                btn3.className = "lock-btn is-locked";
            } else {
                btn3.innerText = "é–‹æ”¾ä¸­ (é»æ­¤é–å®š)";
                btn3.className = "lock-btn is-open";
            }
        }

        document.getElementById('btn-lock-day2').addEventListener('click', () => {
            update(ref(db, 'config'), { lockDay2: !adminLockedDay2 });
        });

        document.getElementById('btn-lock-day3').addEventListener('click', () => {
            update(ref(db, 'config'), { lockDay3: !adminLockedDay3 });
        });

        // å¾Œå°æ•¸æ“šçµ±è¨ˆ
        function loadAdminData() {
            onValue(ref(db, 'orders'), (snapshot) => {
                const orders = snapshot.val();
                if (!orders) {
                    document.getElementById('stats-day2').innerText = "å°šç„¡è¨‚å–®";
                    document.getElementById('stats-day3').innerText = "å°šç„¡è¨‚å–®";
                    return;
                }

                let countDay2 = {};
                let countDay3 = {};
                let userCount = 0;

                Object.values(orders).forEach(order => {
                    userCount++;
                    // çµ±è¨ˆ Day 2
                    if (order.day2) {
                        Object.values(order.day2).forEach(item => {
                            countDay2[item.name] = (countDay2[item.name] || 0) + item.qty;
                        });
                    }
                    // çµ±è¨ˆ Day 3
                    if (order.day3) {
                        Object.values(order.day3).forEach(item => {
                            countDay3[item.name] = (countDay3[item.name] || 0) + item.qty;
                        });
                    }
                });

                document.getElementById('total-orders-count').innerText = userCount;

                // æ¸²æŸ“ Day 2 çµ±è¨ˆ
                let html2 = "";
                for (const [name, qty] of Object.entries(countDay2)) {
                    html2 += `<div class="stat-row"><span>${name}</span><span class="stat-count">${qty}</span></div>`;
                }
                document.getElementById('stats-day2').innerHTML = html2 || "ç„¡è³‡æ–™";

                // æ¸²æŸ“ Day 3 çµ±è¨ˆ
                let html3 = "";
                for (const [name, qty] of Object.entries(countDay3)) {
                    html3 += `<div class="stat-row"><span>${name}</span><span class="stat-count">${qty}</span></div>`;
                }
                document.getElementById('stats-day3').innerHTML = html3 || "ç„¡è³‡æ–™";
            });
        }
    </script>
</body>
</html>
